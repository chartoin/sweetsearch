<!DOCTYPE html>
<html>
<head>
  <title>SweetSearch</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">

    <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track' => true %>
    <!-- Bootstrap -->
    <%= stylesheet_link_tag 'bootstrap' %>
    <!-- jvectormap -->
    <%= stylesheet_link_tag 'jquery-jvectormap-1.2.2' %>
    <!-- DateRangePicker -->
    <%= stylesheet_link_tag 'daterangepicker-bs3' %>
    <!-- Theme style -->
    <%= stylesheet_link_tag 'AdminLTE.min' %>
    <!-- Theme style -->
    <%= stylesheet_link_tag '_all-skins.min' %>
    <%= csrf_meta_tags %>
</head>
<body>

<%= yield %>

</body>
	  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
    <!-- jQuery 2.1.4 -->
    <%= javascript_include_tag 'jQuery-2.1.4.min', 'data-turbolinks-track' => true %>
    <!-- Bootstrap 3.3.5 -->
     <%= javascript_include_tag 'bootstrap.min', 'data-turbolinks-track' => true %>
    <!-- FastClick -->
    <%= javascript_include_tag 'fastclick.min', 'data-turbolinks-track' => true %>
    <!-- AdminLTE App -->
    <%= javascript_include_tag 'app', 'data-turbolinks-track' => true %>
    <!-- Sparkline -->
    <%= javascript_include_tag 'jquery.sparkline.min', 'data-turbolinks-track' => true %>
    <!-- jvectormap -->
    <%= javascript_include_tag 'jquery-jvectormap-1.2.2.min', 'data-turbolinks-track' => true %>
    <%= javascript_include_tag 'jquery-jvectormap-world-mill-en', 'data-turbolinks-track' => true %>
    <!-- SlimScroll 1.3.0 -->
    <%= javascript_include_tag 'jquery.slimscroll.min', 'data-turbolinks-track' => true %>
    <!-- ChartJS 1.0.1 -->
    <%= javascript_include_tag 'Chart.min', 'data-turbolinks-track' => true %>
    <!-- Moment.JS -->
    <%= javascript_include_tag 'moment.min', 'data-turbolinks-track' => true %>
    <!-- DateRangePicker -->
    <%= javascript_include_tag 'daterangepicker', 'data-turbolinks-track' => true %>
    <!-- AdminLTE dashboard -->
    <%= javascript_include_tag 'dashboard2', 'data-turbolinks-track' => true %>
<!-- Load Modals -->
<script>
  $(function() {

    var search_string;

    $('#main_search_form').submit(function (event) {
      event.preventDefault();

      var search_term = $('#search-btn-val').val();

      search_string = search_term;

      postToSolr(search_string);

    });

    $('.language_chooser').find('.active a').click(function() {
        //getLangDateInfo();
    });

    $('.daterangepicker').find('.applyBtn').click(function() {
        getLangDateInfo();
    });
  });

  function getLangDateInfo() {

    var language = "all";
    var start_date = $("input[name=daterangepicker_start]").val();
    var end_date = $("input[name=daterangepicker_end]").val();

    //language = $('.language_chooser').find('.active a').html();
    //console.log("Language is"+language);

    var search_term = $('#search-btn-val').val();

    var search_string = search_term + '&date_from='+start_date + '&date_to='+end_date +'&language='+language;

    postToSolr(search_string);
  }

  function postToSolr(search_query)
  {
    $.post("/welcome/search?query=" + search_query, function (data) {
      console.log(data);

      $('.user_tweet_content').find('.products-list').empty();

      var data_array = data.response.docs;

      for (var i = 0; i < data_array.length; i++) {
        var obj = data_array[i];
        $('.user_tweet_content').find('.products-list').append(
            "<li class ='item'>" +
            "<div class='product-img'>" +
            "<img src=''/>" +
            "</div>" +
            "<div class='product-info'>" +
            "<a href='#' class='product-title person-title'>" +
            obj.id +
            "<span class='label label-success pull-right'>" +
            "</span>" +
            "</a>" +
            "<span class='product-description person-tweet-text'>" +
            obj.text +
            "</span>" +
            "</div>" +
            "</li>"
        );
      }
    });
  }
</script>
</html>
